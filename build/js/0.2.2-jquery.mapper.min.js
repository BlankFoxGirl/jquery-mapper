!function(t){"use strict";t.fn.mapper=function(e){this.settings=t.extend({Title:"Hej!",ApiKey:"YOUR_APIKEY",Debug:!1,Mode:"default",FocusLocation:null,MapSize:{height:400,width:400},Locations:[],googleOptions:{center:{lat:-33.863276,lng:151.107977},zoom:11,mapTypeId:"roadmap"}},e),this.settings.Debug&&console.log("Started!",this),this.map=null,this.markers=[],this.infoWindow=null,this.radius=null,this.mapMode=()=>{switch(this.settings.Mode){case"Locations":var e=document.createElement("div");e.classList="jquery-mapper-controls",e.id="MapControls";var s="";t.each(this.settings.Locations,(e,i)=>{var o=new google.maps.LatLng(parseFloat(i.lat),parseFloat(i.lng)),a=new google.maps.Marker({map:this.map,position:o,label:{text:i.name,fontWeight:"bold"},animation:google.maps.Animation.DROP}),n="";"undefined"!=typeof i.icon&&(n='<img src="'+i.icon+'" alt="'+i.name+'" title="'+i.name+'">');var r='<div data-marker-index="'+e+'" class="location-item'+(""!==n?" icon-supplied":"")+'">'+n+'<span class="title">'+i.name+'</span><span class="phone">'+i.phone+'</span><span class="address">'+i.address+'</span><span class="text">'+i.text+"</span></div>";google.maps.event.addListener(a,"click",()=>{this.infoWindow.setContent(r),this.infoWindow.open(this.map,a),t("#MapControls").children().each((e,s)=>{t(s).removeClass("active")}),t("#MapControls>.location-item[data-marker-index='"+e+"']").addClass("active")}),this.markers.push(a),s+=r}),this.append('<div class="jquery-mapper-controls" id="MapControls">'+s+"</div>"),t("#MapControls>.location-item[data-marker-index]").on("click",e=>{let s=e.currentTarget.getAttribute("data-marker-index");this.settings.Debug&&console.log(e.currentTarget,s),this.infoWindow.setContent('<div class="location-item'+(t(e.currentTarget).hasClass("icon-supplied")?" icon-supplied":"")+'">'+t(e.currentTarget).html()+"</div>"),this.infoWindow.open(this.map,this.markers[s]),t("#MapControls").children().each((e,s)=>{this.settings.Debug&&console.log(e),t(s).removeClass("active")}),t(e.currentTarget).addClass("active")}),t(".mapper-radius-dropdown").on("change",t=>{this.setRadius(t.currentTarget.value)}),t(".mapper-location-name").on("change",t=>{this.searchLocationNames(t.currentTarget.value)})}},this.init=()=>{switch(this.settings.Mode){case"Locations":t(this).addClass("jquery-mapper-container-locations"),t(this).prepend('<div class="mapper-location-search"><input class="mapper-location-name" type="text" placeholder="Location Name"><select class="mapper-radius-dropdown"><option value="">Default</option><option value="100">100km</option><option value="50">50km</option><option value="20">20km</option><option value="10">10km</option><option value="2">2km</option></select></div>')}t(this).addClass("jquery-mapper-container"),t(this).append('<div class="jquery-mapper-map" id="MyMap">lorem</div>'),"undefined"==typeof google?this.importMap():(this.settings.Debug&&console.log(this.settings.googleOptions),null!==this.settings.FocusLocation&&(this.settings.googleOptions.center=this.settings.FocusLocation),this.map=new google.maps.Map(t(".jquery-mapper-map")[0],this.settings.googleOptions),this.infoWindow=new google.maps.InfoWindow,this.mapMode())},this.importMap=()=>{this.settings.Debug&&console.log("Importing google maps with "+this.settings.ApiKey);let e=document.createElement("script");e.src="https://maps.googleapis.com/maps/api/js?key="+this.settings.ApiKey,document.getElementsByTagName("body")[0].appendChild(e),this.thread=window.setInterval(()=>{"undefined"!=typeof google&&(this.settings.Debug&&console.log("Successfully lazy loaded google maps. Now we'll initiate the map!"),clearInterval(this.thread),this.settings.Debug&&console.log(this.settings.googleOptions),null!==this.settings.FocusLocation&&(this.settings.googleOptions.center=this.settings.FocusLocation),this.map=new google.maps.Map(t(".jquery-mapper-map")[0],this.settings.googleOptions),this.infoWindow=new google.maps.InfoWindow,this.mapMode())},100)},this.setRadius=e=>{if(null===e){this.map.setZoom(11);for(let t=0;t<this.markers.length;t++)this.markers[t].visible=!0;return void t(".location-item").show()}const s=isNaN(parseInt(e))?null:parseInt(e);if(null===s){this.map.setZoom(11);for(let t=0;t<this.markers.length;t++)this.markers[t].visible=!0;return void t(".location-item").show()}const i=this.map.center.lat()-1/110*s,o=this.map.center.lat()+1/110*s,a=this.map.center.lng()-1/110*s,n=this.map.center.lng()+1/110*s;for(let l=0;l<this.markers.length;l++)this.markers[l].position.lat()<=o&&this.markers[l].position.lat()>=i&&this.markers[l].position.lng()<=n&&this.markers[l].position.lng()>=a?(t('#MapControls>.location-item[data-marker-index="'+l+'"]').show(),this.markers[l].visible=!0):(t('#MapControls>.location-item[data-marker-index="'+l+'"]').hide(),this.markers[l].visible=!1);let r=11;switch(s){case 2:r=15;break;case 10:r=11;break;case 20:r=10.5;break;case 50:r=9.75;break;case 100:r=9}this.map.setZoom(r),this.radius=s},this.searchLocationNames=e=>{let s=0,i=0;if(null!==e){for(let o=0;o<this.markers.length;o++)-1!==this.markers[o].label.text.toLowerCase().indexOf(e.toLowerCase())?(this.markers[o].visible=!0,t('#MapControls>.location-item[data-marker-index="'+o+'"]').show(),s++,i=o):(this.markers[o].visible=!1,t('#MapControls>.location-item[data-marker-index="'+o+'"]').hide());1===s?(this.map.setCenter(this.markers[i].position),this.map.setZoom(15)):(this.map.setCenter(this.settings.googleOptions.center),11===this.map.zoom?this.map.setZoom(11.5):this.map.setZoom(11))}else{this.map.setZoom(11);for(let t=0;t<this.markers.length;t++)this.markers[t].visible=!0;t(".location-item").show()}},this.init()}}(jQuery);